# 产品需求文档 (PRD)
## 主流媒体新闻转换平台

---

## 1. 产品概述

### 1.1 产品定位
主流媒体新闻转换平台是一个自动化新闻采集、翻译和音频转换平台，帮助用户快速获取并消费国际主流媒体的最新新闻内容。

### 1.2 产品目标
- 提供便捷的新闻站点爬取功能
- 自动将外文新闻翻译成中文
- 将文本新闻转换为音频，支持多场景消费
- 提供友好的用户界面和下载功能

### 1.3 目标用户
- 需要关注国际新闻的用户
- 偏好音频内容的用户
- 需要快速获取多语言新闻内容的用户

---

## 2. 功能需求

### 2.1 核心功能流程

#### 2.1.1 站点URL输入
- **功能描述**：用户输入目标新闻站点URL
- **输入要求**：
  - 支持主流新闻网站（如路透社、BBC、CNN等）
  - URL格式验证
  - 支持历史输入记录
- **交互方式**：文本输入框 + 提交按钮

#### 2.1.2 文章爬取
- **功能描述**：使用Scrapy爬虫抓取目标站点最新文章
- **技术实现**：
  - 使用Scrapy框架进行网页爬取
  - 自动识别文章列表页和详情页
  - 提取文章标题、正文、发布时间、作者等信息
- **限制条件**：
  - 每次爬取最多10篇文章
  - 爬取最新发布的文章（按时间排序）
  - 支持robots.txt协议
- **错误处理**：
  - 网络超时重试机制
  - 无效URL提示
  - 爬取失败提示

#### 2.1.3 文章翻译
- **功能描述**：将爬取的文章翻译成中文
- **技术实现**：
  - 调用免费翻译API（推荐：Google Translate API免费版、DeepL API免费版、百度翻译API等）
  - 支持多语言识别
  - 保持原文格式和段落结构
- **翻译质量要求**：
  - 准确度要求高
  - 保持专业术语准确性
  - 支持长文本分段翻译
- **性能要求**：
  - 单篇文章翻译时间 < 30秒
  - 支持批量翻译

#### 2.1.4 音频转换
- **功能描述**：将翻译后的中文文章转换为音频文件
- **技术实现**：
  - 使用免费TTS（文本转语音）API（推荐：Google TTS、百度语音合成、Azure Speech Services免费版等）
  - 支持中文语音合成
  - 生成MP3格式音频文件
- **音频要求**：
  - 语音清晰自然
  - 支持不同语速选择（可选功能）
  - 音频质量：128kbps以上
- **性能要求**：
  - 单篇文章音频生成时间 < 60秒
  - 支持后台异步生成

#### 2.1.5 内容展示与下载
- **功能描述**：在平台展示文章和音频，提供下载功能
- **展示内容**：
  - 文章列表（标题、发布时间、来源）
  - 文章详情（原文、译文、音频播放器）
  - 文章状态（爬取中、翻译中、音频生成中、完成）
- **下载功能**：
  - 支持下载原文（TXT/PDF）
  - 支持下载译文（TXT/PDF）
  - 支持下载音频（MP3）
  - 支持批量下载
- **交互设计**：
  - 响应式布局，支持移动端
  - 音频在线播放
  - 文章阅读模式（可选）

### 2.2 辅助功能

#### 2.2.1 任务管理
- 显示当前任务状态
- 任务历史记录
- 任务失败重试

#### 2.2.2 站点管理
- 常用站点收藏
- 站点爬取规则配置（可选）

#### 2.2.3 用户设置
- 翻译语言选择（默认：中文）
- 音频语速设置（可选）
- 下载格式选择

---

## 3. 非功能需求

### 3.1 性能要求
- 页面加载时间 < 3秒
- 爬取响应时间 < 60秒（10篇文章）
- 翻译响应时间 < 30秒/篇
- 音频生成响应时间 < 60秒/篇
- 支持并发任务数：3-5个

### 3.2 可用性要求
- 系统可用性 > 95%
- 支持7x24小时运行
- 错误恢复机制完善

### 3.3 安全性要求
- 遵守robots.txt协议
- 控制爬取频率，避免对目标站点造成压力
- 用户数据隐私保护
- API密钥安全存储

### 3.4 兼容性要求
- 浏览器：Chrome、Firefox、Safari、Edge（最新版本）
- 移动端：iOS Safari、Android Chrome
- 响应式设计，适配不同屏幕尺寸

---

## 4. 技术架构

### 4.1 前端技术栈
- **框架**：React 18+
- **UI组件库**：Aceternity UI
- **状态管理**：React Context / Zustand（可选）
- **HTTP客户端**：Axios / Fetch
- **构建工具**：Vite / Create React App
- **样式方案**：Tailwind CSS（Aceternity UI基于此）

### 4.2 后端技术栈
- **语言**：Python 3.9+
- **爬虫框架**：Scrapy
- **Web框架**：Flask / FastAPI（推荐FastAPI）
- **数据库**：SQLite（开发）/ PostgreSQL（生产）
- **任务队列**：Celery + Redis（异步任务处理）
- **API集成**：
  - 翻译API：Google Translate / DeepL / 百度翻译
  - TTS API：Google TTS / 百度语音合成 / Azure Speech

### 4.3 系统架构设计

```
┌─────────────┐
│  前端 (React) │
└──────┬──────┘
       │ HTTP/WebSocket
┌──────▼──────────────────┐
│   后端 API (FastAPI)     │
├─────────────────────────┤
│  - 任务管理              │
│  - 文章管理              │
│  - 文件服务              │
└──────┬──────────────────┘
       │
┌──────▼──────────────────┐
│   任务队列 (Celery)      │
├─────────────────────────┤
│  - 爬取任务              │
│  - 翻译任务              │
│  - 音频生成任务          │
└──────┬──────────────────┘
       │
┌──────▼──────────────────┐
│   外部服务               │
├─────────────────────────┤
│  - Scrapy爬虫            │
│  - 翻译API               │
│  - TTS API               │
└─────────────────────────┘
```

### 4.4 数据模型

#### 4.4.1 任务表 (Tasks)
- id: 主键
- url: 目标站点URL
- status: 任务状态（pending, crawling, translating, generating, completed, failed）
- created_at: 创建时间
- updated_at: 更新时间
- error_message: 错误信息

#### 4.4.2 文章表 (Articles)
- id: 主键
- task_id: 关联任务ID
- title: 文章标题（原文）
- title_cn: 文章标题（中文）
- content: 文章内容（原文）
- content_cn: 文章内容（中文）
- source_url: 原文链接
- publish_time: 发布时间
- author: 作者
- audio_path: 音频文件路径
- created_at: 创建时间

#### 4.4.3 站点表 (Sites) - 可选
- id: 主键
- url: 站点URL
- name: 站点名称
- is_favorite: 是否收藏
- created_at: 创建时间

---

## 5. API设计

### 5.1 任务相关API

#### POST /api/tasks
创建新任务
```json
请求体：
{
  "url": "https://www.reuters.com"
}

响应：
{
  "task_id": "uuid",
  "status": "pending",
  "created_at": "2024-01-01T00:00:00Z"
}
```

#### GET /api/tasks/{task_id}
获取任务状态
```json
响应：
{
  "task_id": "uuid",
  "status": "completed",
  "articles_count": 10,
  "created_at": "2024-01-01T00:00:00Z",
  "updated_at": "2024-01-01T00:05:00Z"
}
```

#### GET /api/tasks
获取任务列表
```json
响应：
{
  "tasks": [
    {
      "task_id": "uuid",
      "url": "https://www.reuters.com",
      "status": "completed",
      "created_at": "2024-01-01T00:00:00Z"
    }
  ],
  "total": 10,
  "page": 1,
  "page_size": 20
}
```

### 5.2 文章相关API

#### GET /api/tasks/{task_id}/articles
获取任务下的文章列表
```json
响应：
{
  "articles": [
    {
      "id": "uuid",
      "title": "Article Title",
      "title_cn": "文章标题",
      "source_url": "https://...",
      "publish_time": "2024-01-01T00:00:00Z",
      "audio_path": "/audio/uuid.mp3"
    }
  ]
}
```

#### GET /api/articles/{article_id}
获取文章详情
```json
响应：
{
  "id": "uuid",
  "title": "Article Title",
  "title_cn": "文章标题",
  "content": "Original content...",
  "content_cn": "中文内容...",
  "source_url": "https://...",
  "publish_time": "2024-01-01T00:00:00Z",
  "audio_path": "/audio/uuid.mp3"
}
```

### 5.3 文件下载API

#### GET /api/articles/{article_id}/download/original
下载原文（TXT格式）

#### GET /api/articles/{article_id}/download/translated
下载译文（TXT格式）

#### GET /api/articles/{article_id}/download/audio
下载音频（MP3格式）

#### POST /api/articles/batch-download
批量下载
```json
请求体：
{
  "article_ids": ["uuid1", "uuid2"],
  "format": "zip"
}
```

---

## 6. 用户界面设计

### 6.1 页面结构

#### 6.1.1 首页
- 站点URL输入框（居中，大尺寸）
- 常用站点快捷入口（可选）
- 最近任务列表
- 使用说明/帮助

#### 6.1.2 任务详情页
- 任务状态指示器（进度条）
- 文章列表（卡片式布局）
  - 文章标题（中英文）
  - 发布时间
  - 状态标签
  - 操作按钮（查看、下载）
- 实时更新（WebSocket或轮询）

#### 6.1.3 文章详情页
- 文章标题（中英文切换）
- 文章内容（原文/译文切换）
- 音频播放器（固定底部或侧边）
- 下载按钮组
- 返回列表按钮

### 6.2 UI/UX要求
- 使用Aceternity UI组件，保持现代美观的设计
- 响应式设计，适配移动端
- 加载状态提示（骨架屏或加载动画）
- 错误提示友好明确
- 操作反馈及时（成功/失败提示）

---

## 7. 开发计划

### 7.1 开发阶段

#### 阶段一：基础架构搭建（1-2周）
- 前端项目初始化（React + Aceternity UI）
- 后端项目初始化（FastAPI）
- 数据库设计及初始化
- 基础API框架搭建

#### 阶段二：核心功能开发（2-3周）
- Scrapy爬虫开发与测试
- 翻译API集成
- TTS API集成
- 任务队列系统搭建

#### 阶段三：前端开发（2周）
- 页面UI开发
- API对接
- 状态管理
- 文件下载功能

#### 阶段四：测试与优化（1-2周）
- 功能测试
- 性能优化
- 错误处理完善
- 用户体验优化

#### 阶段五：部署上线（1周）
- 服务器部署
- 域名配置
- 监控告警设置

### 7.2 技术难点与解决方案

#### 难点1：不同站点的爬取规则
- **解决方案**：为每个主流站点编写专门的Spider，或使用通用规则引擎

#### 难点2：翻译API免费额度限制
- **解决方案**：多API轮换使用，实现降级策略

#### 难点3：长文本音频生成时间
- **解决方案**：异步任务处理，分段生成，进度反馈

#### 难点4：并发任务管理
- **解决方案**：使用Celery任务队列，限制并发数，实现任务优先级

---

## 8. 风险评估

### 8.1 技术风险
- **API服务不稳定**：多API备选方案，实现自动切换
- **爬虫被封禁**：遵守robots.txt，控制爬取频率，使用代理池（可选）
- **性能瓶颈**：异步处理，缓存机制，CDN加速

### 8.2 业务风险
- **版权问题**：仅提供内容展示和转换，不存储原文长期，明确免责声明
- **API费用**：优先使用免费API，监控使用量，设置阈值告警

### 8.3 合规风险
- **数据隐私**：不收集用户个人信息，数据仅用于服务提供
- **内容审核**：不涉及内容审核，用户自行判断内容合法性

---

## 9. 后续优化方向

### 9.1 功能扩展
- 支持更多新闻站点
- 支持多语言翻译（不仅限于中文）
- 支持自定义音频参数（语速、音色等）
- 支持RSS订阅
- 支持定时任务

### 9.2 性能优化
- 实现文章缓存机制
- 音频文件CDN加速
- 数据库查询优化
- 前端代码分割和懒加载

### 9.3 用户体验优化
- 支持文章收藏
- 支持阅读历史
- 支持个性化推荐
- 支持暗黑模式

---

## 10. 附录

### 10.1 推荐API服务

#### 翻译API
- **Google Translate API**：免费额度有限，但质量高
- **DeepL API**：免费版每月50万字符，质量优秀
- **百度翻译API**：免费版每月200万字符，中文翻译效果好

#### TTS API
- **Google Cloud Text-to-Speech**：免费版每月400万字符
- **百度语音合成**：免费版每日5万字符
- **Azure Speech Services**：免费版每月50万字符

### 10.2 参考站点
- 路透社：https://www.reuters.com
- BBC News：https://www.bbc.com/news
- CNN：https://www.cnn.com
- The Guardian：https://www.theguardian.com

---

**文档版本**：v1.0  
**最后更新**：2024-01-01  
**文档维护者**：开发团队

